<!DOCTYPE html>
<html lang="en">
<link href="/static/displaySubCategory.css" rel="stylesheet">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sub Display Category</title>

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection"/>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/Project.js"></script>
        <script src=
                    "https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js">
    </script>

    <script>

          $(document).ready(function(){
    $('select').formSelect();
  });

         $(document).ready(function(){
    $('.tooltipped').tooltip();
  });
    </script>


</head>
<body>
  <div class="mainContainer">
    <div class="box" style="width: 60%">
        <div class="boxHeading">
            <span style="width: 20vw;display: flex;justify-content: flex-start;margin:10px 10px 0px 0px"><a href="http://localhost:8000/subcategoryinterface" class="tooltipped" data-position="top" data-tooltip="Sub Category Interface"><i class="material-icons prefix" style="color: #FFFFFF">add_box</i></a></span>
            <div class="textHeading" style="width: 36vw;display: flex;justify-content: flex-start">Display Sub Category</div>
        </div>
        <table class="striped">
            <thead>
               <tr>
                   <th>Category Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
                   <th>Sub Category Id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
                   <th>Sub Category Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
                   <th>Sub Category Logo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
                   <th>Update</th>
               </tr>
            </thead>
            <tbody>
              {% for row in records %}
               <tr>
                   <td>{{ row.cname }}/[{{ row.categoryid }}]</td>
                   <td>{{ row.subcategoryid }}</td>
                   <td>{{ row.subcategoryname }}</td>
                   <td><img src="/static/{{ row.subcategoryicon }}" width="40" class="imgbtn" subcategoryicon="{{ row.subcategoryicon }}" subcategoryid="{{ row.subcategoryid }}" /> </td>
                   <td><a class="waves-effect waves-light btn modal-trigger editdeletebtn" id="editdeletebtn" cid="{{ row.categoryid }}" cname="{{ row.cname }}" subcategoryid="{{ row.subcategoryid }}" subcategoryname="{{ row.subcategoryname }}"  href="#modal1">Edit/Delete</a></td>
               </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
  </div>

<div id="modal1" class="modal">
    <div class="modal-content">


        <div class="box" style="width:100%;height: auto">
            <div class="boxHeading">
                <div class="textHeading">Sub Category Interface</div>
            </div><br>
            <input type="hidden" id="subcatid" />

            <div class="row">
                <div class="col s12">
                    <div class="input-field">
                        <i class="material-icons prefix">add_shopping_cart</i>
                        <select id="categoryid" >

                            <option value="" disabled selected>Choose Category</option>

                        </select>
                        <label>Category Name</label>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col s12">
                    <div class="input-field">
                        <i class="material-icons prefix">account_circle</i>
                        <input id="subcategoryname" type="text" class="validate" name="subcategory_name">
                        <label for="subcategoryname">Sub Category Name</label>
                    </div>
                </div>
            </div>



                    <div class="row">
            <div class="col s6" >
                <div class="input-field btin">
                    <button class="btn waves-effect waves-light btnText editbtn" type="submit" name="action"
                            id="action">Edit
                        <i class="material-icons right">edit</i>
                    </button>
                </div>
            </div>

            <div class="col s6">
                <div class="input-field btin">
                    <button class="btn waves-effect waves-light btnText delbtn" type="submit" name="action"
                            id="action">Delete
                        <i class="material-icons right">delete</i>
                    </button>
                </div>
            </div>
        </div>

            <!-- <div class="row">
                <div class="col s12">
                    <span class="messageStyle" id="message">{{message}}</span>
                </div>
            </div> -->


            <div class="modal-footer" >
        <a href="#!" class=" waves-effect waves-green btn-flat btnclose">Close</a>
    </div>

        </div>



         </div>

</div>


  <!-- Modal Structure for picture -->

<div id="modal2" class="modal" style="width: 500px">
    <div class="modal-content" >
        <div style="display: flex;justify-content: center;">
               <input type="hidden" id="icon_cid" />
              <img id="img" width="200" height="180">
        </div><br>

        <div><b>Select New Picture:</b></div>

        <div class="file-field input-field">
                        <div class="btn">
                            <span>Sub Category Icon</span>
                            <input type="file" id="newicon" name="subcategory_icon">
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text" >
                        </div>
        </div>

        <div class="input-field btin" style="display: flex;justify-content: flex-start">
                    <button style="width: 100%" class="btn waves-effect waves-light btnText iconbtn" type="submit" name="action"
                            id="action">Edit Logo
                        <i class="material-icons right">edit</i>
                    </button>
                </div>




<div class="modal-footer" >
        <a href="#!" class=" waves-effect waves-green btn-flat btnclose">Close</a>
    </div>

        </div>



         </div>
</body>
<!-- Jquery.com -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
    $(document).ready(function(){

        $('#modal1').modal();
        $('#modal2').modal();

        $('.editdeletebtn').click(function(){
            $('#message').html('')
           $('#categoryid').val($(this).attr('cid'))
            $('#subcatid').val($(this).attr('subcategoryid'))
            $('#subcategoryname').val($(this).attr('subcategoryname'))

         $('select').formSelect()
        })


        $('.editbtn').click(function () {

            $.getJSON('http://localhost:8000/editsubcategory',{categoryid:$('#categoryid').val(),subcategoryid:$('#subcatid').val(),subcategoryname:$('#subcategoryname').val()},function (data) {

                 if (data.result) {
                    swal("Record updated successfully", "", "success", {
                        timer: 1500,
                    });

                } else {
                    swal("Fail to update the record", "", "error", {
                        timer: 1500,
                    });
                }
            })

        })

        $('.delbtn').click(function(){

            $.getJSON('http://localhost:8000/deletesubcategory',{subcategoryid:$('#subcatid').val()},function (data) {

                if (data.result) {
                    swal("Record deleted successfully", "", "success", {
                        timer: 1500,
                    });

                } else {
                    swal("Fail to delete the record", "", "error", {
                        timer: 1500,
                    });
                }
            })

        })


        $('.btnclose').click(function(){

            $('#modal1').modal('close')
            window.location.reload('http://localhost:8000/displaysubcategory')
        })

        $('.imgbtn').click(function () {
            $('#icon_cid').val($(this).attr('subcategoryid'))
            $('#modal2').modal('open')
            $('#img').attr('src',`/static/${$(this).attr('subcategoryicon')}`)
        })



        $('.iconbtn').click(function () {

            var formData = new FormData()
            formData.append('subcategoryid',$('#icon_cid').val())
            var file = $('#newicon')[0].files
            if (file.length > 0)
                formData.append('subcategoryicon', file[0])

            $.ajax({

                url:'/editsubcategoryicon',
                headers:{
                    'X-CSRFToken':'{{ csrf_token }}'
                },
                type:'post',
                data:formData,
                contentType:false,
                processData:false,
                success:function(response){

                    if(response!=0){
                       swal("Icon updated successfully", "", "success", {
                        timer: 1500,
                    });


                    }
                    else
                    {
                       swal("Fail to update the icon", "", "error", {
                        timer: 1500,
                    });

                    }
                }
            })
        })


    })
</script>
</html>