<!DOCTYPE html>
<html lang="en">
    <link href="/static/displayProducts.css" rel="stylesheet">
<head>
    <meta charset="UTF-8">
    <!--Import Google Icon Font-->
     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
     <!--Import materialize.css-->
     <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

    <!-- Compiled and minified CSS -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

   <!-- Compiled and minified JavaScript -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

     <!--Let browser know website is optimized for mobile-->
     <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <script src="/static/Project.js"></script>
     <script src=
                    "https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js">
    </script>
    
   <script>
        $(document).ready(function(){
   $('select').formSelect();
 });

         $(document).ready(function(){
   $('.tooltipped').tooltip();
 });
   </script>
   <title>Display Products</title>
</head>
<body>
    <div class="mainContainer">
        <div class="box" style="width: 90%;">
            <div class="boxHeading">
              <span style="display:flex;justify-content:flex-start;width:35vw"><a href="http://localhost:8000/productinterface" style="color:#FFF" class="tooltipped" data-position="top" data-tooltip="Product Interface"> <i class="material-icons prefix">add_box</i></a>
              </span>
                <div style="display: flex;justify-content:flex-start;width:50vw" class="textHeading">Display Products</div>
            </div>

         <table class="striped">
            <thead>
                <tr>
                <th>Product Id</th>
                <th>Category</th>
                <th>Sub Category</th>
                <th>Brand</th>
                <th>Product Name</th>
                <th>Price</th>
                <th>Offer Price</th>
                <th>Packing Type</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Rating</th>
                <th>Sale Status</th>
                <th>Image</th>
                <th>Update</th>
            </tr>
            </thead>
            <tbody>
                {% for row in records %}
               <tr>
                <td>{{row.productid}}</td>
                <td>{{row.catname}}/[{{row.categoryid}}]</td>
                <td>{{row.subcatname}}/[{{row.subcategoryid}}]</td>
                <td>{{row.brandname}}/[{{row.brandid}}]</td>
                <td>{{row.productname}}</td>
                <td>{{row.price}}</td>
                <td>{{row.offerprice}}</td>
                <td>{{row.packingtype}}</td>
                <td>{{row.quantity}}</td>
                <td>{{row.statuss}}</td>
                <td>{{row.rating}}</td>
                <td>{{row.salestatus}}</td>
                <td><img src="/static/{{row.productimage}}" width="40" class="imgbtn" productid="{{row.productid}}" image="{{row.productimage}}"></td>
                <td><a class="waves-effect waves-light btn modal-trigger editdeletebtn" href="#modal1" productid="{{row.productid}}" categoryid="{{row.categoryid}}" subcategoryid="{{row.subcategoryid}}" brandid="{{row.brandid}}" categoryname="{{row.catname}}" subcategoryname="{{row.subcatname}}" brandname="{{row.brandname}}" productname="{{row.productname}}" price="{{row.price}}" offerprice="{{row.offerprice}}" packingtype="{{row.packingtype}}" quantity="{{row.quantity}}" status="{{row.statuss}}" rating="{{row.rating}}" salestatus="{{row.salestatus}}">Edit/Delete</a></td>
               </tr>
               {% endfor %}
            </tbody>
         </table>

         <div id="modal1" class="modal">
            <div class="modal-content">
 
                    <div class="box" style="width: 100%;">
                        <div class="boxHeading">
                               <div class="textHeading">Product Interface</div>
                        </div>

                <input type="hidden" id="productid">

                <div class="row">
                    <div class="input-field col s4">
                <select id="categoryid" name="category_name">
                  <option value="" disabled selected>Choose your Category</option>
            
                </select>
                <label>Category Name</label>
              </div>
            
                    <div class="input-field col s4">
                <select id="subcategoryid" name="subcategory_name">
                  <option value="" disabled selected>Choose your Sub Category</option>
            
                </select>
                <label>Sub Category Name</label>
              </div>
            
                    <div class="input-field col s4">
                <select id="brandid" name="brand_name">
                  <option value="" disabled selected>Choose your Brand</option>
            
                </select>
                <label>Brand Name</label>
              </div>
            
                </div>
            
            
            <div class="row">
                    <div class="input-field col s12">
                      <i class="material-icons prefix">account_circle</i>
                      <input id="productname" type="text" name="product_name" class="validate">
                      <label for="productname">Product Name</label>
                    </div>
            </div>
            
            <div class="row">
                    <div class="input-field col s6">
                      <i class="material-icons prefix">account_circle</i>
                      <input id="price" type="number" name="product_price" class="validate">
                      <label for="price">Price</label>
                    </div>
            
                    <div class="input-field col s6">
                      <i class="material-icons prefix">account_circle</i>
                      <input id="offerprice" type="number" name="offer_price" class="validate">
                      <label for="offerprice">Offer Price</label>
                    </div>
            </div>
            
            <div class="row">
                <div class="input-field col s6">
                <select id="packingtype" name="packing_type">
                  <option value="" disabled selected>Choose your option</option>
                  <option>Box</option>
                  <option>Packet</option>
                  <option>Bottle</option>
                </select>
                <label>Packing Type</label>
              </div>
            
            
                <div class="input-field col s6">
                      <i class="material-icons prefix">account_circle</i>
                      <input id="quantity" type="number" name="qty" class="validate">
                      <label for="quantity">Quantity</label>
                    </div>
            </div>
            
            <div class="row">
                <div class="input-field col s4">
                <select id="status" name="product_status" >
                  <option value="" disabled selected>Choose your Status</option>
                  <option>Top-Selling</option>
                  <option>Trending</option>
                  <option>Best Seller</option>
                </select>
                <label>Status</label>
              </div>
            
                <div class="input-field col s4">
                      <i class="material-icons prefix">account_circle</i>
                      <input id="rating" type="number" name="rate" class="validate">
                      <label for="rating">Rating</label>
                    </div>
            
                <div class="input-field col s4 radio" style="display: flex;flex-direction: row;justify-content: center;align-items: center">
                <p>
                  <label style="margin-right: 16px">
                    <input class="with-gap salestatus" value="Continue" name="sale_status" type="radio"  />
                    <span>Continue</span>
                  </label>
                </p>
                    <p>
                  <label>
                    <input class="with-gap salestatus" value="Discontinue" name="sale_status" type="radio"/>
                    <span>Discontinue</span>
                  </label>
                </p>
                </div>
            </div>
            
             
                        <div class="row">
                            <div class="input-field col s6" style="display: flex;justify-content: center">
                                <button class="btn waves-effect waves-light" type="submit" name="action" id="editbtn">Edit
                <i class="material-icons right">edit</i>
              </button>
            
                            </div>
            
                            <div class="input-field col s6" style="display: flex;justify-content: center">
                                <button class="btn waves-effect waves-light" type="reset" name="action" id="delbtn">Delete
                <i class="material-icons right">delete</i>
              </button>
            
                            </div>
            
                        </div>
             
            

              <div class="modal-footer">
                <a href="#!" class="modal-close waves-effect waves-green btn-flat closebtn">Close</a>

            </div>
                    </div>
            </div>
            
 
        </div>

        <div id="modal2" class="modal" style="width: 500px;">
          <div class="modal-content">
            
            <div style="display:flex;justify-content:center">
              <input type="hidden" id="icon_pid">
              <img id="icon" width="350" height="150">
            </div>
            <div><b>Select New Picture:</b></div>
 
              <div class="file-field input-field col s12">
                   <div class="btn">
                     <span>Product Image</span>
                     <input type="file" name="product_image" id="newicon">
                   </div>
                   <div class="file-path-wrapper">
                     <input class="file-path validate" type="text">
                   </div>
                 </div>
         

             
                  <div class="input-field col s12" style="display: flex;justify-content: center">
                      <button class="btn waves-effect waves-light iconbtn" type="button" name="action" style="width: 100%;">Edit Picture
      <i class="material-icons right">edit</i>
    </button>
    </div>



            <div class="modal-footer">
              <a href="#!" class="modal-close waves-effect waves-green btn-flat imgclosebtn">Close</a>

          </div>
                  </div>
          </div>

 
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
   $(document).ready(function () {
    $('#modal1').modal()
    $('#modal2').modal()

    $('.editdeletebtn').click(function(){

        $('#message').val('')

        $('#productid').val($(this).attr('productid'))
        $('#categoryid').val($(this).attr('categoryid'))
        $('#subcategoryid').val($(this).attr('subcategoryid'))
        $('#brandid').val($(this).attr('brandid'))
        $('#productname').val($(this).attr('productname'))
        $('#price').val($(this).attr('price'))
        $('#offerprice').val($(this).attr('offerprice'))
        $('#packingtype').val($(this).attr('packingtype'))
        $('#quantity').val($(this).attr('quantity'))
        $('#status').val($(this).attr('status'))
        $('#rating').val($(this).attr('rating'))
        $('.salestatus').val($(this).attr('salestatus'))
    })

    $.getJSON('http://localhost:8000/Fetch_All_Sub_Category_JSON',{categoryid:$('#categoryid').val()},function(data){

      var records=data.data
      records.map((item)=>{
      $('#subcategoryid').append($('<option>').text(item.subcategoryname).val(item.subcategoryid))
      })
      $('select').formSelect()
      $('#subcategoryid').val($('#subcategoryid').val())
    })

    $('#editbtn').click(function(){

        $.getJSON('http://localhost:8000/editproduct',{

            productid:$('#productid').val(),
            categoryid:$('#categoryid').val(),
            subcategoryid:$('#subcategoryid').val(),
            brandid:$('#brandid').val(),
            productname:$('#productname').val(),
            price:$('#price').val(),
            offerprice:$('#offerprice').val(),
            packingtype:$('#packingtype').val(),
            quantity:$('#quantity').val(),
            status:$('#status').val(),
            rating:$('#rating').val(),
            salestatus:$('.salestatus').val()
        },function(data){

            if(data)
            {
              swal("Record updated successfully", "", "success", {
                timer: 1500,
                    });            }
            else
            {
              swal("Fail to update the record", "", "error", {
                timer: 1500,
                    });            }
        })
    })

    $('#delbtn').click(function(){

        $.getJSON('http://localhost:8000/deleteproduct',{productid:$('#productid').val()},function(data){

            if(data)
            {
              swal("Record deleted successfully", "", "success", {
                timer: 1500,
                    });
            }
            else
            {
              swal("Fail to delete the record", "", "error", {
                timer: 1500,
                    });
            }
        })
    })

    $('.closebtn').click(function(){

$('#modal1').modal('close')
window.location.reload('http://localhost:8000/displayproduct')
})

    $('.imgclosebtn').click(function(){

      $('#modal2').modal()
      window.location.reload('http://localhost:8000/displayproduct')
    })

    $('.imgbtn').click(function(){

      $('#icon_pid').val($(this).attr('productid'))
      $('#modal2').modal('open')
      $('#icon').attr('src',`/static/${$(this).attr('image')}`)
    })

    $('.iconbtn').click(function(){

      var formData=new FormData()
      formData.append('productid',$('#icon_pid').val())
      var file=$('#newicon')[0].files
      if(file.length>0)
           formData.append('productimage',file[0])
      
           $.ajax({

            url:'/editproductimage',
            headers:{
              'X-CSRFToken':'{{csrf_token}}'
            },
            type:'post',
            data:formData,
            contentType:false,
            processData:false,
            success:function(response){
              if(response!=0){
                       swal("Icon updated successfully", "", "success", {
                        timer: 1500,
                    });


                    }
                    else
                    {
                       swal("Fail to update the icon", "", "error", {
                        timer: 1500,
                    });

                    }
            }
          })
    })
   })

    
</script>
</html>